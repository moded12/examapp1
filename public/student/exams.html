<!doctype html>
<html lang="ar" dir="rtl" class="notranslate" translate="no">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† â€” Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- Google AdSense (Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© ÙÙ‚Ø·) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8177765238464378"
          crossorigin="anonymous"></script>

  <style>
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      font-family:'Tajawal',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:linear-gradient(135deg,#eff6ff,#e5e7eb);
      color:#0f172a;
    }
    .dark body{
      background:linear-gradient(135deg,#0b1220,#0f172a);
      color:#e5e7eb;
    }

    .mode-btn{
      background:#e2e8f0;
      color:#0f172a;
      padding:6px 10px;
      border-radius:10px;
      font-weight:700;
      font-size:0.8rem;
    }
    .mode-btn:hover{ background:#cbd5e1 }
    .dark .mode-btn{ background:#1f2937; color:#e5e7eb }
    .dark .mode-btn:hover{ background:#334155 }

    .row-btn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:#1d4ed8;
      color:#fff;
      padding:14px 16px;
      border-radius:12px;
      box-shadow:0 8px 18px -10px rgba(29,78,216,.45);
      border:1px solid rgba(255,255,255,.25);
      transition:background .18s, transform .18s, box-shadow .18s;
      text-align:right;
    }
    .row-btn:hover{
      background:#1b47c8;
      transform:translateY(-1px);
      box-shadow:0 12px 24px -14px rgba(29,78,216,.55);
    }
    .row-btn:focus{
      outline:3px solid rgba(59,130,246,.55);
      outline-offset:2px;
    }
    .row-btn .title{
      font-weight:800;
      font-size:1.02rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-left:8px;
    }
    .row-btn .meta{
      font-size:.8rem;
      opacity:.95;
      white-space:nowrap;
    }

    body.ov-open{ overflow:hidden }

    .ov{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1000;
    }
    .ov.show{ display:flex; }

    .ov .box{
      background:#0b1220;
      color:#e5e7eb;
      width:min(1200px,96vw);
      height:min(92svh,940px);
      border-radius:18px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      box-shadow:0 24px 60px rgba(0,0,0,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
      outline:1px solid rgba(255,255,255,.06);
    }
    .ov header{
      display:flex;
      align-items:center;
      gap:8px;
      justify-content:space-between;
      padding:10px 12px;
      background:#0e172a;
      border-bottom:1px solid #1f2a3a;
    }
    .ov header h3{
      margin:0;
      font-size:15px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .ov header .btn{
      background:#1f2937;
      color:#e5e7eb;
      border:0;
      padding:6px 10px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      font-size:0.8rem;
    }
    .ov header .btn:hover{ background:#273244 }
    .ov header .btn.close{ background:#ef4444 }
    .ov header .btn.close:hover{ background:#dc2626 }

    .ov .body{
      flex:1;
      display:grid;
      grid-template-columns:1fr 280px;
      min-height:0;
    }
    .ov .body.no-side{ grid-template-columns:1fr; }

    .ov .viewer{
      position:relative;
      background:#0b1220;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
      min-width:0;
      min-height:0;
    }
    .ov .viewer iframe,
    .ov .viewer embed{
      width:100%;
      height:100%;
      border:0;
      background:#ffffff;
    }
    .ov .viewer img{
      width:100%;
      height:100%;
      object-fit:contain;
      background:#0b1220;
    }
    .ov .side{
      border-left:1px solid #1f2a3a;
      overflow:auto;
      background:#0b1220;
    }
    .ov .side.hidden{ display:none; }
    .ov .file-item{
      padding:12px;
      border-bottom:1px solid #1f2a3a;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:0.9rem;
    }
    .ov .file-item:hover{ background:#101a2e; }

    .wm{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:9;
      opacity:.22;
      background-repeat:repeat;
      background-size:300px 240px;
    }

    .loading{
      color:#94a3b8;
      font-size:.95rem;
    }
    .loading::after{
      content:' ...';
      animation:dots 1s steps(3,end) infinite;
    }
    @keyframes dots{
      0%{content:''}
      33%{content:'.'}
      66%{content:'..'}
      100%{content:'...'}
    }
  </style>
</head>

<body class="bg-transparent">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="bg-white/95 dark:bg-slate-900/95 border-b border-blue-100 dark:border-slate-800 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 py-2.5 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <button id="goBackBtn" class="mode-btn !bg-slate-200 dark:!bg-slate-800" type="button" title="Ø±Ø¬ÙˆØ¹ Ø®Ø·ÙˆØ©">â¬…ï¸</button>
        <a id="homeLink" href="#"
           class="text-base sm:text-xl md:text-2xl font-extrabold text-blue-800 dark:text-blue-300 hover:underline decoration-2 flex items-center gap-1">
          <span class="hidden sm:inline">ğŸ‡´ğŸ‡²</span>
          <span>Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ù†Ù‡Ø§Ø¬ Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†</span>
        </a>
      </div>
      <div class="flex items-center gap-3 text-xs sm:text-sm">
        <a id="bcSubjects" href="#" class="hidden sm:inline text-blue-700 dark:text-blue-300 hover:underline">Ø§Ù„Ù…ÙˆØ§Ø¯</a>
        <button id="toggleTheme" class="mode-btn" type="button" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†">ğŸŒ™</button>
      </div>
    </div>
  </header>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <main class="flex-1 max-w-5xl mx-auto w-full px-4 sm:px-6 py-5 sm:py-7">
    <div class="text-center mb-6">
      <h2 class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">
        Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
      </h2>
      <div id="hdr" class="mt-2 text-sm sm:text-base text-slate-700 dark:text-slate-300"></div>
      <p class="text-[12px] sm:text-sm text-slate-600 dark:text-slate-400 mt-1">
        Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ù†ÙˆØ§Ù† Ù„ÙØªØ­ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¹Ø§Ø±Ø¶Ø©.
      </p>
    </div>

    <div id="list" class="space-y-3"></div>
    <div id="msg" class="mt-8 text-center text-sm text-slate-600 dark:text-slate-400"></div>

    <!-- âœ… Ø¥Ø¹Ù„Ø§Ù† ÙŠØ¯ÙˆÙŠ ÙˆØ§Ø­Ø¯ Ù‚Ø¨Ù„ Ø§Ù„ÙÙˆØªØ± -->
    <section class="mt-8 max-w-3xl mx-auto">
      <div class="rounded-2xl bg-white/95 dark:bg-slate-900/85 border border-slate-200 dark:border-slate-700 shadow p-3">
        <p class="text-[11px] text-slate-500 dark:text-slate-400 mb-1 text-right">Ø¥Ø¹Ù„Ø§Ù†</p>

        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8177765238464378"
             data-ad-slot="2136328739"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
    </section>

  </main>

  <!-- Ø§Ù„ÙÙˆØªØ± -->
  <footer class="bg-slate-900 text-white py-3 mt-auto">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 text-center text-xs sm:text-sm">
      Â© <span id="yr"></span> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© | Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ù†Ù‡Ø§Ø¬ Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†
    </div>
  </footer>

  <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª -->
  <div id="ov" class="ov" aria-modal="true" role="dialog">
    <div class="box">
      <header>
        <div class="flex items-center gap-3 min-w-0">
          <button class="btn close" type="button" onclick="closeOv()">Ø¥ØºÙ„Ø§Ù‚</button>
          <h3 id="ov_title" class="truncate" title=""></h3>
        </div>
        <div class="flex items-center gap-2">
          <button id="openTab" class="btn" type="button" title="ÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨">â†—ï¸ ÙØªØ­</button>
          <button id="downloadFile" class="btn" type="button" title="ØªÙ†Ø²ÙŠÙ„">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„</button>
          <button id="toggleSide" class="btn" type="button" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª">ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª</button>
        </div>
      </header>
      <div id="ovBody" class="body no-side">
        <div id="viewer" class="viewer">
          <div id="wm" class="wm" aria-hidden="true"></div>
          Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù
        </div>
        <div id="filesSide" class="side hidden"></div>
      </div>
    </div>
  </div>

  <script>
  // Ø³Ù†Ø© Ø§Ù„ÙÙˆØªØ±
  document.getElementById('yr').textContent = new Date().getFullYear();

  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø«Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø§Øª
  const pathName = location.pathname;
  const marker   = '/student/';
  const baseStudent = pathName.includes(marker)
    ? pathName.slice(0, pathName.indexOf(marker) + marker.length)
    : pathName.replace(/[^/]*$/, '');
  const HOME_URL = new URL(baseStudent + '../', location.origin).href;

  // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
  (function initTheme(){
    const saved = localStorage.getItem('theme');
    if (saved === 'dark' || (!saved && window.matchMedia && matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    }
    document.getElementById('toggleTheme').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.setItem(
        'theme',
        document.documentElement.classList.contains('dark') ? 'dark' : 'light'
      );
    });
  })();

  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
  (function navHelpers(){
    const back = document.getElementById('goBackBtn');
    const homeLink = document.getElementById('homeLink');
    homeLink.href = HOME_URL;
    back.addEventListener('click', () => {
      if (window.history.length > 1) window.history.back();
      else location.href = HOME_URL;
    });
  })();

  const API = baseStudent + '../admin.php';

  const p = new URLSearchParams(location.search);
  const grade_id   = +p.get('grade_id');
  const subject_id = +p.get('subject_id');
  const term_no    = +p.get('term_no');

  const DEFAULT_WM = 'Ø§ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù†Ù‡Ø§Ø¬ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©';

  async function apiGet(action, obj = {}){
    try{
      const u = new URL(API, location.origin);
      u.searchParams.set('action', action);
      Object.entries(obj).forEach(([k,v])=>{
        if (v !== '' && v != null) u.searchParams.set(k, v);
      });
      const r = await fetch(u, { cache:'no-store' });
      const t = await r.text();
      let j;
      try { j = JSON.parse(t); }
      catch { j = { ok:false, error:'invalid json', raw:t }; }
      return j;
    } catch(e){
      return { ok:false, error:e.message };
    }
  }

  const absUrl = (pth) => {
    try{ return new URL(pth, location.origin).href; }
    catch{ return pth; }
  };

  function iconOf(mime, path){
    const mm  = (mime||'').toLowerCase();
    const pth = (path||'').toLowerCase();
    if (mm.includes('pdf') || /\.pdf(\?|$)/i.test(pth)) return 'ğŸ“•';
    if (mm.includes('image') || /\.(png|jpg|jpeg|webp|gif)(\?|$)/i.test(pth)) return 'ğŸ–¼ï¸';
    if (mm === 'link' || pth.startsWith('http')) return 'ğŸ”—';
    return 'ğŸ“„';
  }

  const isPDF = (mime, url) =>
    (mime||'').toLowerCase().includes('pdf') || /\.pdf(\?|$)/i.test(url||'');

  function applyWatermark(text){
    const el = document.getElementById('wm');
    if (!el) return;
    if (!text){
      el.style.display = 'none';
      el.style.backgroundImage = 'none';
      return;
    }
    el.style.display = 'block';
    el.style.backgroundImage = buildWatermarkSVG(text);
  }

  function buildWatermarkSVG(text, cfg){
    const opt = Object.assign({
      fill:'#ffffff',
      stroke:'#000000',
      fillOpacity:0.22,
      strokeOpacity:0.22,
      size:26,
      rotate:-30
    }, cfg || {});
    const t = (text||'')
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" width="300" height="240">
        <g transform="rotate(${opt.rotate} 150 120)">
          <text x="150" y="128"
            fill="${opt.fill}" fill-opacity="${opt.fillOpacity}"
            stroke="${opt.stroke}" stroke-opacity="${opt.strokeOpacity}" stroke-width="1"
            font-size="${opt.size}" font-family="Tajawal, Arial, sans-serif" text-anchor="middle">
            ${t}
          </text>
        </g>
      </svg>`;
    return 'url("data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg) + '")';
  }

  function openOv(title, files){
    window.__files = files || [];
    document.getElementById('ov_title').textContent = title;
    document.getElementById('ov_title').title = title;
    const ov    = document.getElementById('ov');
    const bodyEl= document.getElementById('ovBody');
    const side  = document.getElementById('filesSide');
    side.classList.add('hidden');
    bodyEl.classList.add('no-side');
    ov.classList.add('show');
    document.body.classList.add('ov-open');
    renderViewer(window.__files[0]);
    renderSide(window.__files);
    applyWatermark(DEFAULT_WM);
  }

  function closeOv(){
    if (window.currentBlobUrl){
      URL.revokeObjectURL(window.currentBlobUrl);
      window.currentBlobUrl = '';
    }
    window.currentFileUrl = '';
    document.getElementById('ov').classList.remove('show');
    document.body.classList.remove('ov-open');
  }
  window.closeOv = closeOv;

  window.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape') closeOv();
  });

  document.getElementById('toggleSide').addEventListener('click', ()=>{
    const side   = document.getElementById('filesSide');
    const bodyEl = document.getElementById('ovBody');
    const show   = side.classList.contains('hidden');
    side.classList.toggle('hidden', !show);
    bodyEl.classList.toggle('no-side', !show);
  });

  async function renderViewer(file){
    const v = document.getElementById('viewer');
    if (!file){
      v.innerHTML = '<div class="text-slate-300 text-sm">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù</div>';
      return;
    }
    const mime = (file.mime||'').toLowerCase();
    const raw  = (file.path||file.file_path||'').trim();
    const path = absUrl(raw);
    window.currentFileUrl = path;
    if (window.currentBlobUrl){
      URL.revokeObjectURL(window.currentBlobUrl);
      window.currentBlobUrl = '';
    }

    const wmEl = document.getElementById('wm');

    const isImage = mime.includes('image') || /\.(png|jpg|jpeg|webp|gif)(\?|$)/i.test(path);
    if (isImage){
      v.innerHTML = '';
      const img = document.createElement('img');
      img.src = path; img.alt = '';
      v.appendChild(img);
      v.appendChild(wmEl);
      document.getElementById('openTab').disabled = false;
      document.getElementById('downloadFile').disabled = false;
      return;
    }

    const pdf = isPDF(mime, path);
    if (pdf){
      v.innerHTML = '';
      const loading = document.createElement('div');
      loading.className = 'loading';
      loading.textContent = 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù';
      v.appendChild(loading);

      let url = path;
      if (location.protocol === 'https:' && url.startsWith('http:')){
        url = url.replace(/^http:/,'https:');
        window.currentFileUrl = url;
      }

      let shown = false;
      try{
        const res = await fetch(url, { credentials:'omit', cache:'no-cache' });
        if (res.ok){
          const ct  = (res.headers.get('content-type')||'').toLowerCase();
          const buf = await res.blob();
          const blob = (ct.includes('pdf') ? buf : new Blob([buf],{type:'application/pdf'}));
          const blobUrl = URL.createObjectURL(blob);
          window.currentBlobUrl = blobUrl;

          v.innerHTML = '';
          const iframe = document.createElement('iframe');
          iframe.src   = blobUrl + '#toolbar=1&navpanes=0&view=FitH';
          iframe.title = 'PDF';
          iframe.loading = 'eager';
          v.appendChild(iframe);
          v.appendChild(wmEl);
          shown = true;
        }
      }catch(_e){}

      if (!shown){
        v.innerHTML = '';
        const embed = document.createElement('embed');
        embed.type = 'application/pdf';
        embed.src  = url + (url.includes('#') ? '' : '#toolbar=1&view=FitH');
        v.appendChild(embed);
        v.appendChild(wmEl);
      }

      document.getElementById('openTab').disabled = false;
      document.getElementById('downloadFile').disabled = false;
      return;
    }

    v.innerHTML =
      '<div class="text-center"><a class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm" href="' +
      path + '" target="_blank" rel="noopener">ÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯</a></div>';
    v.appendChild(wmEl);
    document.getElementById('openTab').disabled = false;
    document.getElementById('downloadFile').disabled = false;
  }

  function renderSide(files){
    const s = document.getElementById('filesSide');
    s.innerHTML = '';
    if (!files || !files.length){
      s.innerHTML = '<div class="p-4 text-slate-400 text-sm">Ù„Ø§ Ù…Ø±ÙÙ‚Ø§Øª</div>';
      return;
    }
    files.forEach(f=>{
      const pth = f.path||f.file_path||'';
      const d = document.createElement('div');
      d.className = 'file-item';
      d.innerHTML =
        '<span>' + iconOf(f.mime, pth) + '</span>' +
        '<span class="truncate flex-1">' + ((pth.split('/').pop()) || 'Ù…Ù„Ù') + '</span>';
      d.addEventListener('click',()=> renderViewer(f));
      s.appendChild(d);
    });
  }

  document.getElementById('openTab').addEventListener('click', ()=>{
    if (window.currentFileUrl) window.open(window.currentFileUrl, '_blank','noopener');
  });

  document.getElementById('downloadFile').addEventListener('click', ()=>{
    if (!window.currentFileUrl) return;
    const a = document.createElement('a');
    a.href = window.currentFileUrl;
    a.download = '';
    document.body.appendChild(a);
    a.click();
    a.remove();
  });

  async function loadExams(){
    const msg     = document.getElementById('msg');
    const listBox = document.getElementById('list');

    if (!grade_id || !subject_id || !term_no){
      msg.textContent = 'Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù†Ø§Ù‚ØµØ©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ù…Ø§Ø¯Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
      return;
    }

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    (async ()=>{
      const grades = await apiGet('get_grades');
      const gRow   = (grades.data||[]).find(x=>+x.id === grade_id);

      const subs   = await apiGet('get_subjects_by_grade',{ grade_id });
      const sRow   = (subs.data||[]).find(x=>+x.id === subject_id);

      document.getElementById('bcSubjects').href = 'subjects.html?grade_id='+grade_id;

      document.getElementById('hdr').innerHTML =
        'Ø§Ù„ØµÙ: <span class="font-extrabold text-blue-700 dark:text-blue-300">' + (gRow ? gRow.name_ar : '') + '</span>' +
        ' â€¢ Ø§Ù„Ù…Ø§Ø¯Ø©: <span class="font-extrabold">' + (sRow ? sRow.name_ar : '') + '</span>' +
        ' â€¢ Ø§Ù„ÙØµÙ„: <span class="font-extrabold">' + term_no + '</span>';
    })();

    msg.textContent = '... Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†';
    listBox.innerHTML = '';

    const res  = await apiGet('list_exams', { grade_id, subject_id, term_no });
    const data = (res && (res.data || res.rows)) || [];

    const list = data.map(ex=>{
      const title = ex.title || ex.exam_title || ex.name || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
      const exam_date = ex.exam_date || '';
      let files = [];
      if (ex.files){
        files = (ex.files||[])
          .map(f=>({ path:f.path||f.file_path||f.url||'', mime:f.mime||f.type||'' }))
          .filter(x=>x.path);
      }
      return { title, exam_date, files };
    });

    if (!list.length){
      msg.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ÙˆÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹.';
      return;
    }
    msg.textContent = '';

    list.forEach(ex=>{
      const files = ex.files || [];
      const btn   = document.createElement('button');
      btn.type    = 'button';
      btn.className = 'row-btn';
      const meta = (files.length ? files.length + ' Ù…Ù„Ù' : 'Ù„Ø§ Ù…Ø±ÙÙ‚Ø§Øª') +
                   (ex.exam_date ? ' â€¢ ' + ex.exam_date : '');
      btn.innerHTML =
        '<span class="title">' + ex.title + '</span>' +
        '<span class="meta">' + meta + '</span>';
      btn.addEventListener('click', ()=> openOv(ex.title, files));
      listBox.appendChild(btn);
    });
  }

  (async function init(){
    await loadExams();

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙŠØ¯ÙˆÙŠ
    try{
      (adsbygoogle = window.adsbygoogle || []).push({});
    }catch(e){}
  })();
  </script>
</body>
</html>
